{% extends "base.html" %}
{% block content %}
<div class="cockpit-wrap">
    <div class="cockpit-title">
        <h2>ìŠ¤ëƒ…ìƒ· ê´€ë¦¬ (Admin)</h2>
    </div>

    <div class="card" style="margin-bottom: 20px;">
        <div class="card-head">
            <p class="card-title">ğŸ“‚ ì‹ ê·œ ìŠ¤ëƒ…ìƒ· ì—…ë¡œë“œ</p>
        </div>
        <form action="/admin/upload" method="post" enctype="multipart/form-data"
            style="display:flex; gap:10px; align-items:center;">
            <input type="file" name="files" accept=".xlsx" required multiple class="input"
                style="background: rgba(15,30,55,0.5); color: #fff; border-color: rgba(96,165,250,0.3);">
            <button type="submit" class="btn">ì—…ë¡œë“œ</button>
        </form>

        {% if report %}
        <div
            style="margin-top: 15px; padding: 15px; background: rgba(30,58,138,0.2); border-radius: 8px; border: 1px solid rgba(96,165,250,0.2);">
            <h3 style="margin-top:0; font-size:14px; color:#fff;">ì—…ë¡œë“œ ê²°ê³¼</h3>
            <p style="font-size:13px; color:rgba(255,255,255,0.8);">{{ report.message }}</p>
            {% if report.success %}
            <p style="font-size:13px; color:rgba(52,211,153,0.9);">í”„ë¡œì íŠ¸ ì²˜ë¦¬: {{ report.processed_projects }}, ì´ë²¤íŠ¸ ì²˜ë¦¬: {{
                report.processed_events }}</p>
            {% else %}
            <p style="font-size:13px; color:rgba(239,68,68,0.9);">ì—…ë¡œë“œ ì‹¤íŒ¨</p>
            {% endif %}

            {% if report.warnings %}
            <div style="margin-top:10px; color:rgba(251,191,36,0.9); font-size:12px;">
                <strong>ê²½ê³ :</strong>
                <ul style="margin:5px 0 0 20px; padding:0;">
                    {% for w in report.warnings %}
                    <li>{{ w }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if report.errors %}
            <div style="margin-top:10px; color:rgba(239,68,68,0.9); font-size:12px;">
                <strong>ì˜¤ë¥˜:</strong>
                <ul style="margin:5px 0 0 20px; padding:0;">
                    {% for e in report.errors %}
                    <li>{{ e }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <div class="card">
        <div class="card-head">
            <p class="card-title">ğŸ“‹ ìŠ¤ëƒ…ìƒ· ëª©ë¡</p>
        </div>
        <table class="table-dark">
            <thead>
                <tr>
                    <th>ë‚ ì§œ</th>
                    <th>ì—…ë¡œë“œ ì‹œê°„</th>
                    <th>íŒŒì¼ëª…</th>
                    <th>ëŒ€ì‹œë³´ë“œ</th>
                    <th>í”„ë¡œì íŠ¸</th>
                    <th>ì´ë²¤íŠ¸</th>
                </tr>
            </thead>
            <tbody>
                {% for s in snapshots %}
                <tr>
                    <td>{{ s['snapshot_date'] }}</td>
                    <td>{{ s['uploaded_at'] }}</td>
                    <td>{{ s['source_filename'] }}</td>
                    <td><a href="/?snapshot_id={{ s['snapshot_id'] }}" class="link">ë³´ê¸°</a></td>
                    <td><a href="/admin/projects?snapshot_id={{ s['snapshot_id'] }}" class="link">ê´€ë¦¬</a></td>
                    <td><a href="/admin/events?snapshot_id={{ s['snapshot_id'] }}" class="link">ê´€ë¦¬</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}